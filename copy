
  nestjs-graphql:
    build:
      context: ./graphql
      dockerfile: Dockerfile
    depends_on: [postgres]
    ports:
      - "5001:5001"
    environment:
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DATABASE=postgres
      - PORT=5001

  nestjs-anti-fraud:
    build:
      context: ./anti-fraud
      dockerfile: Dockerfile
    depends_on: [kafka]
    environment:
      - KAFKA_BROKER=kafka:29092
      - KAFKA_GROUP_ID=antifraud-yape
      - KAFKA_CLIENT_ID=antifraud

  nestjs-transactions:
    build:
      context: ./transactions
      dockerfile: Dockerfile
    depends_on: [nestjs-graphql, kafka]
    ports:
      - "5000:5000"
    environment:
      - PORT=5000    
      - GRAPHQL_SERVER=nestjs-graphql:5001/graphql
      - KAFKA_BROKER=kafka:29092
      - KAFKA_GROUP_ID=transaction-yape
      - KAFKA_CLIENT_ID=transaction